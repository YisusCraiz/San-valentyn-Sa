<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For My Love ❤️</title>
<style>
body { margin:0; overflow:hidden; background:black; }
canvas { display:block; }
</style>
</head>
<body>

<audio id="bgMusic" loop>
    <source src="music.mp3" type="audio/mpeg">
</audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x000000, 0.0006);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 8000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ===== LUCES ===== */
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const pointLight = new THREE.PointLight(0xff4d88,3);
pointLight.position.set(300,300,300);
scene.add(pointLight);

/* =========================
   GALAXIA → CORAZON
========================= */
const totalStars = 8000;
const galaxyGeo = new THREE.BufferGeometry();
const galaxyVertices = [];
const heartPositions = [];

for(let i=0;i<totalStars;i++){
    galaxyVertices.push(
        THREE.MathUtils.randFloatSpread(4000),
        THREE.MathUtils.randFloatSpread(4000),
        THREE.MathUtils.randFloatSpread(4000)
    );

    let t = Math.random()*Math.PI*2;
    let x = 16*Math.pow(Math.sin(t),3);
    let y = 13*Math.cos(t)-5*Math.cos(2*t)
           -2*Math.cos(3*t)-Math.cos(4*t);

    heartPositions.push(x*20,y*20,THREE.MathUtils.randFloatSpread(200));
}

galaxyGeo.setAttribute('position', new THREE.Float32BufferAttribute(galaxyVertices,3));
const galaxyMat = new THREE.PointsMaterial({color:0xff4d88,size:2});
const galaxy = new THREE.Points(galaxyGeo, galaxyMat);
scene.add(galaxy);

let transformProgress=0;
let transformToHeart=false;

/* =========================
   CORAZON CENTRAL
========================= */
const heartShape = new THREE.Shape();
heartShape.moveTo(0,0);
heartShape.bezierCurveTo(0,0,-2,-2,-2,-4);
heartShape.bezierCurveTo(-2,-6,0,-8,0,-6);
heartShape.bezierCurveTo(0,-8,2,-6,2,-4);
heartShape.bezierCurveTo(2,-2,0,0,0,0);

const heartGeo = new THREE.ExtrudeGeometry(heartShape,{depth:2,bevelEnabled:true});
const heartMat = new THREE.MeshStandardMaterial({
    color:0xff4d88,
    emissive:0xff4d88,
    emissiveIntensity:1.5
});
const heart = new THREE.Mesh(heartGeo, heartMat);
scene.add(heart);

/* =========================
   FRASES
========================= */
const loader = new THREE.FontLoader();
let currentIndex = 0;
let intervalID;
let loveMode = false;

loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function(font){

const phrases = [
"You look at me with those honey-colored eyes",
"Your warm brown eyes run all over my skin",
"They hypnotize me",
"As beautiful as that sunset",
"I love you, Sarai",
];

function createText(text){

    const geo = new THREE.TextGeometry(text,{
        font:font,
        size:70,
        height:8,
        bevelEnabled:true,
        bevelThickness:2,
        bevelSize:1
    });

    geo.center();

    const mat = new THREE.MeshStandardMaterial({
        color:0xffffff,
        emissive:0xff4d88,
        emissiveIntensity:1.5
    });

    const mesh = new THREE.Mesh(geo,mat);
    scene.add(mesh);

    setTimeout(()=>{ scene.remove(mesh); },4000);
}

function cycleTexts(){

    createText(phrases[currentIndex]);

    if(currentIndex === phrases.length-1){
        setTimeout(()=>{
            activateLoveRain();
        },4000);
        clearInterval(intervalID);
    }

    currentIndex++;
}

intervalID = setInterval(cycleTexts,5000);
});

/* =========================
   LLUVIA INFINITA TE AMO
========================= */
let rainTexts = [];

function activateLoveRain(){

    loveMode = true;
    scene.remove(heart);

    const overlay = document.createElement("canvas");
    overlay.width = window.innerWidth;
    overlay.height = window.innerHeight;
    overlay.style.position="absolute";
    overlay.style.top="0";
    overlay.style.left="0";
    overlay.style.pointerEvents="none";
    document.body.appendChild(overlay);

    const ctx = overlay.getContext("2d");

    for(let i=0;i<80;i++){
        rainTexts.push({
            x:Math.random()*overlay.width,
            y:Math.random()*overlay.height,
            speed:2+Math.random()*3
        });
    }

    function rain(){
        ctx.clearRect(0,0,overlay.width,overlay.height);
        ctx.fillStyle="#ff4d88";
        ctx.font="30px Arial";

        rainTexts.forEach(t=>{
            ctx.fillText("I LOVER YOU",t.x,t.y);
            t.y+=t.speed;
            if(t.y>overlay.height){
                t.y=-20;
                t.x=Math.random()*overlay.width;
            }
        });

        requestAnimationFrame(rain);
    }

    rain();
}

/* =========================
   AUDIO
========================= */
const audio=document.getElementById("bgMusic");
const context=new (window.AudioContext||window.webkitAudioContext)();
const src=context.createMediaElementSource(audio);
const analyser=context.createAnalyser();
src.connect(analyser);
analyser.connect(context.destination);
analyser.fftSize=256;
const dataArray=new Uint8Array(analyser.frequencyBinCount);

camera.position.z = 1000;

/* =========================
   ANIMACION
========================= */
function animate(){
requestAnimationFrame(animate);

analyser.getByteFrequencyData(dataArray);
let bass=dataArray[2]/255;

heart.scale.set(1+bass*0.8,1+bass*0.8,1+bass*0.8);
heart.rotation.y+=0.01;

/* CAMARA */
camera.position.x = Math.sin(Date.now()*0.0003)*400;
camera.position.y = Math.cos(Date.now()*0.0002)*200;
camera.lookAt(scene.position);

/* TRANSFORMACION A CORAZON */
if(transformToHeart && transformProgress<1){
    transformProgress+=0.003;
    const pos = galaxy.geometry.attributes.position;

    for(let i=0;i<totalStars;i++){
        pos.setX(i,
            galaxyVertices[i*3] +
            (heartPositions[i*3] - galaxyVertices[i*3])*transformProgress
        );
        pos.setY(i,
            galaxyVertices[i*3+1] +
            (heartPositions[i*3+1] - galaxyVertices[i*3+1])*transformProgress
        );
        pos.setZ(i,
            galaxyVertices[i*3+2] +
            (heartPositions[i*3+2] - galaxyVertices[i*3+2])*transformProgress
        );
    }
    pos.needsUpdate = true;
}

renderer.render(scene,camera);
}
animate();

/* CLICK */
document.addEventListener("click",()=>{
audio.play();
transformToHeart=true;
});

/* RESPONSIVE */
window.addEventListener("resize",()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>

</body>
</html>
